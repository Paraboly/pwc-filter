<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"
    />
    <title>Stencil Component Starter</title>

    <script type="module" src="/build/pwc-filter.esm.js"></script>
    <script nomodule src="/build/pwc-filter.js"></script>

    <style>
      body {
        width: 500px;
      }
    </style>
  </head>
  <body>
    <pwc-filter></pwc-filter>

    <hr />

    <input type="button" id="filter-to-console" value="Filter to console" />

    <div style="margin-top: 25px; margin-bottom: 25px"></div>

    <input type="text" id="item-id" placeholder="Item ID" />
    <button id="remove-item-button">Remove Item</button>
    <button id="add-item-button">Add Item</button>

    <script>
      document.addEventListener("DOMContentLoaded", e => {
        const pwcFilter = document.querySelector("pwc-filter");

        // You can also get the values manually if you wish.
        // We provide a "filter()" method that filters the data
        // with the current state of the form.
        // Here, we hook up to a buttons's onClick event and
        // print the filtered data to the console.
        document
          .querySelector("#filter-to-console")
          .addEventListener("click", e => {
            pwcFilter.filter().then(filtered => {
              console.log("filtered data: ", filtered);
            });
          });

        // You can listen to the "filterChaned" event to get the
        // freshly filtered data when the dynamic form changes.
        pwcFilter.addEventListener("filterChanged", e => {
          console.log("filter changed event:", e);
          console.log("new filter result:", e.detail.filterResult);
        });

        document
          .querySelector("#add-item-button")
          .addEventListener("click", e => {
            const id = document.querySelector("#item-id").value;
            pwcFilter.addItem({
              dataField: "bazola",
              type: "checkbox",
              name: id,
              id: id,
              label: "cb1-label"
            });
          });

        document
          .querySelector("#remove-item-button")
          .addEventListener("click", e => {
            const id = document.querySelector("#item-id").value;
            pwcFilter.removeItem(id);
          });

        (async function() {
          // init();
          // await waitForSecondsAndInit(1);
          // init();
          // await waitForSecondsAndInit(1);
          // init();
          // await waitForSecondsAndInit(1);
          // init();
          // await waitForSecondsAndInit(1);
          // init();
          //initForDeepSearch();
          init();
        })();

        function initForDeepSearch() {
          const data = [
            {
              a: [
                {
                  b: [
                    {
                      c: "foo",
                      d: "non_relevant_value"
                    },
                    {
                      c: "bar",
                      d: "non_relevant_value"
                    }
                  ],
                  e: "first one"
                }
              ]
            },
            {
              a: [
                {
                  b: [
                    {
                      c: "baz",
                      d: "non_relevant_value"
                    },
                    {
                      c: "bar",
                      d: "non_relevant_value"
                    }
                  ],
                  e: "second one"
                }
              ]
            },
            {
              a: [
                {
                  b: [
                    {
                      c: "foo",
                      d: "non_relevant_value"
                    },
                    {
                      c: "foo",
                      d: "non_relevant_value"
                    }
                  ],
                  e: "third one"
                }
              ]
            }
          ];

          // Step 1: Assign the data to the filter.
          pwcFilter.data = data;

          // Step 2: Instruct the filter how to generate form elements.
          // The format is as follows: (data field: form element config)
          pwcFilter.items = [
            {
              dataField: "a.b.c",
              type: "select-multi",
              label: "a.b.c filter element",
              placeholder: "plaaaacehooolder"
            }
          ];
        }

        function init() {
          // An arbitrary dataset to test the filter.
          // It has no significance on its own.
          const data = [
            {
              index: 1,
              foo: 41,
              bar: 19.8397,
              baz: "Kristine",
              thud: "Matthews",
              quax: "Randy Zimmerman",
              grunt: "allison@anthony.uz",
              bazola: true
            },
            {
              index: 1,
              foo: 41,
              bar: 19.8397,
              baz: "Kristine",
              thud: "Matthews",
              quax: "Randy Zimmerman",
              grunt: "allison@anthony.uz",
              bazola: true
            },
            {
              index: 2,
              foo: 18,
              bar: 19.4668,
              baz: "Sheryl",
              thud: "Somebody",
              quax: "Martin Summers",
              grunt: "lewis@erickson.om",
              bazola: false
            },
            {
              index: 3,
              foo: 26,
              bar: 15.868,
              baz: "Charlene",
              thud: "Henry",
              quax: "Faye Coble",
              grunt: "alvin@li.gm",
              bazola: false
            },
            {
              index: 4,
              foo: 35,
              bar: 16.9081,
              baz: "Brooke",
              thud: "Cross",
              quax: "Jill Dawson",
              grunt: "lewis@connolly.no",
              bazola: true
            },
            {
              index: 5,
              foo: 15,
              bar: 16.0845,
              baz: "Cathy",
              thud: "Tyson",
              quax: "Sherri Teague",
              grunt: "milton@mcmillan.as",
              bazola: false
            },
            {
              index: 6,
              foo: 18,
              bar: 16.3167,
              baz: "Doris",
              thud: "Kennedy",
              quax: "Pauline Curry",
              grunt: "george@starr.sz",
              bazola: false
            },
            {
              index: 7,
              foo: 46,
              bar: 10.5112,
              baz: "Joann",
              thud: "Blackwell",
              quax: "Shannon Foster",
              grunt: "louis@james.cl",
              bazola: false
            },
            {
              index: 8,
              foo: null,
              bar: 12.8977,
              baz: "Amanda",
              thud: "Houston",
              quax: "Oscar Cannon",
              grunt: "victor@scott.cl",
              bazola: true
            },
            {
              index: 9,
              foo: undefined,
              bar: 13.304,
              baz: "Colleen",
              thud: "Gross",
              quax: "Theodore May",
              grunt: "grace@casey.ms",
              bazola: false
            },
            {
              index: 10,
              foo: 38,
              bar: 11.7118,
              baz: "Rita",
              thud: null,
              quax: "Christopher Baldwin",
              grunt: "sandra@king.edu",
              bazola: true
            }
          ];

          // Step 1: Assign the data to the filter.
          pwcFilter.data = data;

          // Step 2: Instruct the filter how to generate form elements.
          // The format is as follows: (data field: form element config)
          pwcFilter.items = [
            {
              dataField: "foo",
              name: "foo_filter",
              type: "select-multi",
              label: "foo filter element",
              distinctMode: "value",
              placeholder: "Type to search...",
              labelProvider: value => "label of " + value,
              iconProvider: value => {
                return {
                  src:
                    "https://www.drupal.org/files/styles/grid-3-2x/public/project-images/mWrrADXf_400x400.jpg",
                  width: "20px",
                  height: "20px",
                  placement: "left"
                };
              },
              displayIconsOnInputBar: true,
              dropdownSelectionBehaviour: "toggle"
            },
            {
              dataField: "thud",
              name: "thud_filter",
              type: "select-multi",
              label: "thud filter element",
              distinctMode: "value",
              placeholder: "Type to search..."
            },
            {
              dataField: "bazola",
              name: "bazola_filter",
              type: "checkbox",
              label: "bazola filter element",
              style: {
                margin: "10px"
              }
            }
          ];

          pwcFilter.handleNullAndUndefinedSeparately = true;
        }
      });

      // Below are functions to help us test the lazy loading, they are not related to the usage
      async function waitForSecondsAndInit(seconds) {
        await sleep(seconds);
        console.log("here I am");
      }

      function timeout(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
      async function sleep(seconds) {
        await timeout(seconds * 1000);
      }
    </script>
  </body>
</html>
